# 视频扫描与智能批量压缩工具——为管理大型视频库而生
<img width="1056" height="580" alt="image" src="https://github.com/user-attachments/assets/9dd973a5-b37c-43e7-b4b7-d99bd1a60ede" />
<img width="500" height="430" alt="image" src="https://github.com/user-attachments/assets/8e650c1a-4ead-4104-a221-084f55bc9941" />
本人小白，有一个很多TB的视频库，当视频越来越多的时候，体积会受限，所以想到了使用压缩工具压缩已有的视频，但是从网上下的的视频压缩工具，很多其实并不好用，你也不知道压缩完了以后体积有没有变化，也没有办法真正的批量处理视频，保证压缩以后的视频跟原版差不多，但是可以减少很多体积，所以通过ai写下了下面一个工具，帮助大家管理本地视频，简单方便，经测试转过的视频在emby上都是正常播放的，如果有什么好的想法，可以联系我，看看能不能改一改

一个基于 PyQt6 的强大视频压缩工具，能够智能分析视频文件并推荐压缩方案，支持多种现代编码格式。

## 功能特点

### 🎯 智能分析
- 自动检测视频编码格式（H.264、H.265、AV1、VP9等）
- 计算压缩价值评分（0-100分）
- 预估压缩后节省空间百分比
- 自动区分动画与实拍内容
- 支持字幕和音轨数量检测

### 🔄 多种编码支持
- **H.264** - 兼容性最佳
- **H.265/HEVC** - 高效率压缩
- **VP9** - 先进的网络视频编码
- **AV1** - 下一代开源编码格式

### 📊 智能参数优化
- 根据分辨率自动调整参考帧和B帧数量
- 动画/实拍场景自动选择优化参数
- CRF质量参数预设优化值
- 多线程并行处理

### 🖥️ 用户友好界面
- 可视化视频文件列表
- 实时压缩进度显示
- 后台日志查看
- 右键菜单管理
- 批量文件处理

## 系统要求

### 软件要求
- Python 3.8 或更高版本
- FFmpeg（必须添加到系统PATH）
- Windows 7/8/10/11（已测试）或 Linux（理论上支持）

### 硬件建议
- 4GB以上内存
- 支持硬件加速的显卡（可选）
- 足够的硬盘空间用于临时文件

## 安装步骤

### 1. 安装 Python
从 [python.org](https://www.python.org/) 下载并安装 Python 3.8+

### 2. 安装 FFmpeg
- **Windows**: 从 [ffmpeg.org](https://ffmpeg.org/download.html) 下载，解压并添加 `bin` 目录到系统PATH
- **Linux**: `sudo apt install ffmpeg` (Ubuntu/Debian) 或 `sudo yum install ffmpeg` (CentOS)

### 3. 安装依赖
```bash
pip install PyQt6 psutil
```

### 4. 运行程序
```bash
python videomanager.py
```

## 使用方法

### 基本流程
1. **扫描视频**：点击"扫描文件夹"选择包含视频的目录
2. **选择文件**：在列表中勾选要压缩的视频
3. **设置参数**：选择编码器和CRF值
4. **开始压缩**：点击"压缩勾选视频"

### 参数说明

#### 编码器选择
- **libx264 (H.264)**：兼容性最好，适合通用用途
- **libx265 (H.265)**：压缩率更高，适合高分辨率视频
- **libvpx-vp9 (VP9)**：适合网络流媒体
- **libaom-av1 (AV1)**：最新的开源编码，压缩率最高

#### CRF值（Constant Rate Factor）
- **H.264**: 推荐 18-23（数值越低质量越高）
- **H.265**: 推荐 20-28
- **VP9**: 推荐 28-36
- **AV1**: 推荐 28-40

#### 高级功能
- **删除源文件**：压缩成功后自动删除原始文件
- **暂停/继续**：在压缩过程中可以暂停和继续
- **停止任务**：安全停止当前压缩任务
- **日志查看**：实时查看压缩进度和详细信息

## 文件支持格式

### 视频格式
.mp4, .mkv, .avi, .mov, .wmv, .flv, .webm, .m4v, .ts, .mts, .m2ts, .rm, .rmvb, .mpg, .mpeg, .vob, .3gp, .f4v, .asf, .ogv, .dv

### 字幕格式
SRT, ASS, SSA, WebVTT

## 技术特性

### 智能压缩算法
- 基于熵值检测自动区分动画/实拍
- 根据分辨率动态调整编码参数
- 音频和字幕流无损复制
- 元数据（章节、标签）保留

### 缓存系统
- 自动缓存视频分析结果
- 基于文件大小和修改时间验证
- 配置文件保存在 `config.json`

### 错误处理
- 无效文件自动跳过
- 压缩失败保护机制
- 进程异常清理
- 磁盘空间检查

## 性能优化

### 多线程处理
- 独立扫描线程，不阻塞UI
- 后台压缩，支持暂停/继续
- 实时进度反馈

### 资源管理
- 内存使用优化
- 临时文件清理
- 进程优先级控制

## 常见问题

### Q: 压缩速度太慢怎么办？
A: 尝试使用H.264编码器，降低预设（preset）级别，或使用硬件加速版本

### Q: 压缩后文件反而变大了？
A: 检查原始视频编码，如果是已经高效编码的视频（如H.265），压缩空间有限

### Q: 字幕丢失了？
A: 确保原视频的字幕是支持的文本格式（SRT、ASS等），不支持图片字幕

### Q: 音频不同步？
A: 可能是原始文件时间戳问题，尝试重新封装而不是重新编码

## 高级用法

### 批量处理
```python
# 可以通过修改代码实现自动化批量处理
files = ["video1.mp4", "video2.mkv"]
thread = CompressThread(files, encoder="libx265", crf=23)
```

### 自定义参数
在代码中修改 `pick_ref_bframes` 函数可以调整帧参考参数

## 开发说明

### 项目结构
```
video_compressor.py    # 主程序
config.json           # 配置文件（自动生成）
```

### 代码架构
- `VideoScanner` - 主界面类
- `ScanThread` - 视频扫描线程
- `CompressThread` - 压缩处理线程
- `ConvertLogDialog` - 日志显示对话框

### 依赖库
- PyQt6 - GUI框架
- psutil - 进程管理
- FFmpeg - 视频处理后端

## 注意事项

1. **备份重要文件**：压缩前建议备份原始视频
2. **磁盘空间**：确保有足够的空间存储压缩后的文件
3. **编码时间**：AV1和VP9编码速度较慢，适合离线处理
4. **版权问题**：请确保您有处理视频的合法权利

## 更新日志

### v1.0.0 (当前版本)
- 初始发布
- 支持4种编码器
- 智能分析系统
- 完整的GUI界面

## 许可证

本项目基于 MIT 许可证开源，可以自由使用、修改和分发。

## 贡献

欢迎提交问题和拉取请求！

1. Fork 项目
2. 创建功能分支
3. 提交更改
4. 推送到分支
5. 创建 Pull Request

**提示**：对于首次使用，建议先用少量视频测试，熟悉操作流程和参数设置后再进行批量处理。
